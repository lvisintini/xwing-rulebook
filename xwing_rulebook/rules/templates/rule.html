{% extends 'base.html' %}
{% load markdown %}
{% load xwing_icons %}
{% load rule_to_markdown %}

{% block meta-title  %}{{ rule.name }}{% endblock %}

{% block page_wrapper_class %} u-background-dark{% endblock %}

{% block content %}
  <div class="Book">
    <div class="Book__Inner Book__Inner--fancy-border">
      <div class="u-text-right">
        <a href="{% url 'rules:index' %}">&#8592; Back to index</a>
      </div>

      {{ rule | rule_as_anchored_markdown:1 | md2html }}

      {% with rule|filter_related_rules_by_type:RULE_TYPES.RULE_CLARIFICATION as clarifications %}
        {% if clarifications.count %}
          <h2>Rule Clarifications</h2>
          {% for clarification in clarifications %}
            {{ clarification | rule_as_anchored_markdown:3 | md2html }}
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% with rule|filter_related_rules_by_type:RULE_TYPES.CARD_ERRATA as card_erratas %}
        {% if card_erratas.count %}
          <h2>Errata</h2>
          {% for card_errata in card_erratas %}
            {{ card_errata | rule_as_anchored_markdown:3 | md2html }}
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% with rule|filter_related_rules_by_type:RULE_TYPES.CARD_CLARIFICATION as clarifications %}
        {% if clarifications.count %}
          <h2>Clarification</h2>
          {% for clarification in clarifications %}
            {{ clarification | rule_as_anchored_markdown:3 | md2html }}
          {% endfor %}
        {% endif %}
      {% endwith %}

      {{ rule | related_topics_as_rule_linked_list_markdown | md2html }}

      {{ '[Epic]' | xwing_icons  }}
    </div>
  </div>
{% endblock %}
